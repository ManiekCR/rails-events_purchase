<div class="container">
  <div>
    <h1>Checkout summary</h1>
    <% puts params.inspect %>
    <p>Purchase one <strong><%= current_user.orders.where(state: 'pending').find(params[:order_id]).event.name %></strong> ticket for <strong><%= humanized_money_with_symbol current_user.orders.where(state: 'pending').find(params[:order_id]).amount %></strong></p>
    <button id="pay" class="btn btn-primary">Pay</button>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
      const paymentButton = document.getElementById('pay');
      paymentButton.addEventListener('click', () => {
        const stripe = Stripe('<%= ENV['STRIPE_PUBLISHABLE_KEY'] %>');
        stripe.redirectToCheckout({
          sessionId: '<%= current_user.orders.where(state: 'pending').find(params[:order_id]).checkout_session_id %>'
        });
      });
    </script>
  </div>
</div>
